<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Parser Agent v1.0 - Prompt Engineering Lab</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: visible;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 30px);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: visible;
        }

        .top-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            border-bottom: 2px solid #e9ecef;
            background: #f8f9fa;
        }

        .input-panel, .prompt-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .panel-header {
            font-weight: 600;
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .input-group input[type="file"] {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .content-textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            resize: vertical;
        }

        .prompt-textarea {
            width: 100%;
            height: 180px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            resize: vertical;
            background: #f8f9fa;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .prompt-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .prompt-selector {
            flex: 1;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
        }

        .comparison-toggle {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .toggle-switch {
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-input {
            width: 50px;
            height: 25px;
            background: #ccc;
            border-radius: 25px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-input.active {
            background: #28a745;
        }

        .toggle-input::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-input.active::before {
            transform: translateX(25px);
        }

        .results-section {
            flex: 1;
            overflow: visible;
            min-height: 400px;
        }

        .single-result {
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: 400px;
        }

        .comparison-result {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            min-height: 400px;
        }

        .result-panel {
            display: flex;
            flex-direction: column;
            overflow: visible;
            border-right: 2px solid #e9ecef;
        }

        .result-panel:last-child {
            border-right: none;
        }

        .result-header {
            background: #495057;
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: center;
            font-size: 14px;
        }

        .result-content {
            flex: 1;
            overflow: auto;
            padding: 0;
        }

        .json-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin: 0;
            height: 100%;
            overflow: auto;
        }

        .structured-content {
            padding: 15px;
            height: 100%;
            overflow: auto;
        }

        .sample-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .sample-btn {
            padding: 5px 10px;
            background: #e9ecef;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #495057;
            transition: all 0.2s;
        }

        .sample-btn:hover {
            background: #17a2b8;
            color: white;
        }

        .error-display {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px;
        }

        .confidence-display {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-weight: 600;
            text-align: center;
        }

        .section-item {
            background: #f8f9fa;
            border-left: 3px solid #28a745;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 0 4px 4px 0;
            font-size: 14px;
        }

        .skill-tag {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin: 2px;
        }

        .work-item, .education-item, .project-item {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
        }

        .work-item h6, .education-item h6, .project-item h6 {
            color: #495057;
            margin-bottom: 5px;
        }

        .small-text {
            font-size: 13px;
            color: #6c757d;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-processing { background: #ffc107; }

        /* CV-specific styles */
        .cv-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
        }

        .cv-name {
            font-size: 2rem;
            font-weight: 700;
            margin: 0 0 10px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .cv-contact-info {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 10px;
        }

        .contact-item {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .cv-links {
            display: flex;
            gap: 15px;
        }

        .link-item a {
            color: white;
            text-decoration: none;
            font-weight: 500;
        }

        .link-item a:hover {
            text-decoration: underline;
        }

        .cv-section {
            margin-bottom: 25px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-title {
            background: #f8f9fa;
            color: #495057;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 12px 15px;
            margin: 0;
            border-bottom: 2px solid #e9ecef;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section-content {
            padding: 15px;
        }

        .summary-text {
            font-size: 1rem;
            line-height: 1.6;
            color: #333;
            margin-bottom: 10px;
        }

        .skills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .skill-badge {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .experience-entry {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .experience-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .experience-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 5px;
        }

        .position-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #495057;
            margin: 0;
        }

        .duration-badge {
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .company-name {
            font-size: 1rem;
            color: #667eea;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .responsibilities-list {
            margin: 8px 0 0 20px;
            padding: 0;
        }

        .responsibilities-list li {
            margin-bottom: 5px;
            line-height: 1.5;
            color: #555;
        }

        .education-entry {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .education-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .education-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 5px;
        }

        .degree-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #495057;
            margin: 0;
        }

        .graduation-year {
            background: #17a2b8;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .institution-name {
            color: #667eea;
            font-weight: 500;
        }

        .certifications-list, .achievements-list, .volunteer-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .certification-item, .achievement-item, .volunteer-item {
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
            color: #555;
        }

        .project-entry {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .project-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .project-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #495057;
            margin: 0 0 8px 0;
        }

        .project-description {
            color: #555;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .project-tech {
            color: #667eea;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .project-link a {
            color: #28a745;
            text-decoration: none;
            font-weight: 500;
        }

        .project-link a:hover {
            text-decoration: underline;
        }

        .cv-additional-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .additional-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .languages-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 15px;
        }

        .language-tag {
            background: #ffc107;
            color: #212529;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .parsing-notes {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
        }

        .parsing-notes .section-title {
            background: #ffc107;
            color: #212529;
        }

        .parsing-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .parsing-note:last-child {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>👤 CV Parser Agent v1.0 - Prompt Engineering Lab</h1>
            <p>Test, compare, and optimize CV parsing prompts with LLM-powered analysis</p>
        </div>

        <div class="main-content">
            <div class="top-section">
                <div class="input-panel">
                    <div class="panel-header">📄 CV Input</div>
                    
                    <div class="sample-buttons">
                        {% for sample_id, sample_content in sample_cvs.items() %}
                        <div class="sample-btn" onclick="loadSample('{{ sample_id }}')">
                            {{ sample_id.replace('_', ' ').title() }}
                        </div>
                        {% endfor %}
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label for="fileInput">📎 Upload CV File</label>
                            <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt" onchange="handleFileUpload(event)">
                        </div>
                        <button class="btn btn-primary" onclick="processCV()" id="processBtn">
                            <span class="status-indicator status-success" id="statusIndicator"></span>
                            🚀 Process CV
                        </button>
                    </div>

                    <div class="input-group">
                        <label for="cvContent">✍️ CV Content</label>
                        <textarea id="cvContent" class="content-textarea" placeholder="Paste CV content here or upload a file..."></textarea>
                    </div>
                </div>

                <div class="prompt-panel">
                    <div class="panel-header">🧠 Prompt Engineering</div>
                    
                    <div class="prompt-controls">
                        <select id="promptSelector" class="prompt-selector">
                            <option value="default">Default CV Parsing Prompt</option>
                        </select>
                        <button class="btn btn-secondary" onclick="loadPrompt()">Load</button>
                        <button class="btn btn-info" onclick="savePrompt()">Save</button>
                    </div>

                    <div class="input-group">
                        <label for="promptContent">⚙️ Parsing Prompt</label>
                        <textarea id="promptContent" class="prompt-textarea" placeholder="Loading prompt..."></textarea>
                    </div>

                    <div class="control-buttons">
                        <button class="btn btn-warning" onclick="testWithPrompt()">🧪 Test Custom</button>
                        <button class="btn btn-info" onclick="saveAsDefault()">💾 Set Default</button>
                    </div>
                </div>
            </div>

            <div class="comparison-toggle">
                <div class="toggle-switch">
                    <span>Single Result</span>
                    <div class="toggle-input" id="comparisonToggle" onclick="toggleComparison()"></div>
                    <span>Compare Prompts</span>
                </div>
            </div>

            <div class="results-section">
                <div class="single-result" id="single-result">
                    <div class="result-panel">
                        <div class="result-header">📋 Raw JSON Output</div>
                        <div class="result-content">
                            <pre id="json-output" class="json-output">Test a prompt to see JSON results...</pre>
                        </div>
                    </div>
                    <div class="result-panel">
                        <div class="result-header">✨ Structured Content</div>
                        <div class="result-content">
                            <div id="structured-output" class="structured-content">
                                <div style="text-align: center; padding: 50px; color: #6c757d;">
                                    <h4>📄 CV Parser Results</h4>
                                    <p>Upload or paste a CV and click "Process CV" to see parsed results</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="comparison-result" id="comparison-result" style="display: none;">
                    <div class="result-panel">
                        <div class="result-header">📋 Prompt A - JSON</div>
                        <div class="result-content">
                            <pre id="json-output-a" class="json-output">Select prompts to compare...</pre>
                        </div>
                    </div>
                    <div class="result-panel">
                        <div class="result-header">✨ Prompt A - Structured</div>
                        <div class="result-content">
                            <div id="structured-output-a" class="structured-content">
                                <div style="text-align: center; padding: 50px; color: #6c757d;">
                                    <p>Prompt A results will appear here</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="result-panel">
                        <div class="result-header">📋 Prompt B - JSON</div>
                        <div class="result-content">
                            <pre id="json-output-b" class="json-output">Select prompts to compare...</pre>
                        </div>
                    </div>
                    <div class="result-panel">
                        <div class="result-header">✨ Prompt B - Structured</div>
                        <div class="result-content">
                            <div id="structured-output-b" class="structured-content">
                                <div style="text-align: center; padding: 50px; color: #6c757d;">
                                    <p>Prompt B results will appear here</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sample CVs Data -->
    <script>
        const sampleCVs = {
            {% for sample_id, sample_content in sample_cvs.items() %}
            "{{ sample_id }}": {{ sample_content|tojson }},
            {% endfor %}
        };

        let currentPrompt = "";
        let lastResults = null;
        let comparisonMode = false;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadPrompt();
        });

        // Load sample CV
        function loadSample(sampleId) {
            if (sampleCVs[sampleId]) {
                const cvTextArea = document.getElementById('cvContent');
                const fileInput = document.getElementById('fileInput');
                
                // Set the sample text content
                cvTextArea.value = sampleCVs[sampleId];
                
                // Clear file input since we're using text content now
                fileInput.value = '';
                fileInput.files = null; // Also clear the files property
                
                // Reset placeholder text
                cvTextArea.placeholder = 'Paste CV content here or upload a file...';
                
                // Sample loaded successfully
                
                updateStatus('success', `Sample CV loaded: ${sampleId.replace('_', ' ')}`);
            }
        }

        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            updateStatus('processing', `File selected: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`);
            
            // For PDFs, DOCs, and other binary formats, we'll let the LLM process them
            // Don't try to read as text - just store the file reference
            if (file.type === 'application/pdf' || 
                file.type === 'application/msword' || 
                file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
                
                updateStatus('success', `Document ready: ${file.name} - Click 'Process CV' to analyze`);
                // Clear the text area to show file is the primary source
                document.getElementById('cvContent').value = '';
                document.getElementById('cvContent').placeholder = `File selected: ${file.name} - Document will be processed by LLM`;
                
            } else {
                // For text files, we can read them directly
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('cvContent').value = e.target.result;
                    updateStatus('success', `Text file loaded: ${file.name} (${e.target.result.length} characters)`);
                };
                reader.onerror = function() {
                    updateStatus('error', `Failed to read ${file.name}`);
                };
                reader.readAsText(file);
            }
        }

        // Process CV
        async function processCV() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const cvText = document.getElementById('cvContent').value.trim();
            
            // Priority logic: Determine if we should use text or file processing
            const isTextPlaceholder = cvText.includes('File selected:') && cvText.includes('Document will be processed by LLM');
            const hasRealTextContent = cvText && !isTextPlaceholder;
            
            // Priority logic: Use text processing when real text content is provided
            
            // Use text processing if there's real text content (not just placeholder)
            if (hasRealTextContent) {
                // User has provided text content - use text processing and clear file input
                updateStatus('processing', 'Processing CV text...');
                
                try {
                    const response = await fetch('/parse', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({cv_text: cvText})
                    });

                    const data = await response.json();

                    if (data.success) {
                        displayResults(data.result, 'json-output', 'structured-output');
                        lastResults = data.result;
                        updateStatus('success', 'CV text processed successfully');
                        // Clear file input since we used text instead
                        fileInput.value = '';
                    } else {
                        displayError(data.error, 'json-output', 'structured-output');
                        updateStatus('error', 'Text processing failed');
                    }
                } catch (error) {
                    displayError(error.message, 'json-output', 'structured-output');
                    updateStatus('error', 'Network error');
                }
                
            } else if (file) {
                // Use file processing when no real text content is provided
                updateStatus('processing', `Processing file: ${file.name}...`);
                
                try {
                    // Send actual file to backend for Claude document processing
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    const response = await fetch('/parse_file', {
                        method: 'POST',
                        body: formData  // Don't set Content-Type header - let browser set it
                    });

                    const data = await response.json();

                    if (data.success) {
                        displayResults(data.result, 'json-output', 'structured-output');
                        lastResults = data.result;
                        updateStatus('success', `File processed: ${file.name}`);
                    } else {
                        displayError(data.error, 'json-output', 'structured-output');
                        updateStatus('error', 'File processing failed');
                    }
                } catch (error) {
                    displayError(error.message, 'json-output', 'structured-output');
                    updateStatus('error', 'File processing error');
                }
                
            } else {
                updateStatus('error', 'Please upload a CV file or provide CV text content');
                return;
            }
        }

        // Load prompt
        async function loadPrompt() {
            try {
                const response = await fetch('/get_current_prompt');
                const data = await response.json();
                
                if (data.success) {
                    currentPrompt = data.prompt;
                    document.getElementById('promptContent').value = data.prompt;
                } else {
                    updateStatus('error', 'Failed to load prompt');
                }
            } catch (error) {
                updateStatus('error', 'Error loading prompt');
            }
        }

        // Save prompt as default
        async function saveAsDefault() {
            const prompt = document.getElementById('promptContent').value.trim();
            
            if (!prompt) {
                updateStatus('error', 'Please provide a prompt');
                return;
            }

            try {
                const response = await fetch('/set_default_prompt', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({prompt: prompt})
                });

                const data = await response.json();

                if (data.success) {
                    currentPrompt = prompt;
                    updateStatus('success', 'Prompt saved as default');
                } else {
                    updateStatus('error', 'Failed to save prompt');
                }
            } catch (error) {
                updateStatus('error', 'Error saving prompt');
            }
        }

        // Test with custom prompt
        async function testWithPrompt() {
            const cvText = document.getElementById('cvContent').value.trim();
            const customPrompt = document.getElementById('promptContent').value.trim();
            
            if (!cvText) {
                updateStatus('error', 'Please provide CV content');
                return;
            }

            if (!customPrompt) {
                updateStatus('error', 'Please provide a custom prompt');
                return;
            }

            updateStatus('processing', 'Testing custom prompt...');

            try {
                const response = await fetch('/parse_with_prompt', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({cv_text: cvText, prompt: customPrompt})
                });

                const data = await response.json();

                if (data.success) {
                    if (comparisonMode) {
                        displayResults(data.result, 'json-output-b', 'structured-output-b');
                    } else {
                        displayResults(data.result, 'json-output', 'structured-output');
                    }
                    updateStatus('success', 'Custom prompt test completed');
                } else {
                    const outputId = comparisonMode ? 'json-output-b' : 'json-output';
                    const structuredId = comparisonMode ? 'structured-output-b' : 'structured-output';
                    displayError(data.error, outputId, structuredId);
                    updateStatus('error', 'Custom prompt test failed');
                }
            } catch (error) {
                updateStatus('error', 'Network error');
            }
        }

        // Toggle comparison mode
        function toggleComparison() {
            comparisonMode = !comparisonMode;
            const toggle = document.getElementById('comparisonToggle');
            const singleResult = document.getElementById('single-result');
            const comparisonResult = document.getElementById('comparison-result');
            
            if (comparisonMode) {
                toggle.classList.add('active');
                singleResult.style.display = 'none';
                comparisonResult.style.display = 'grid';
                
                // Load default prompt results in A panel if we have last results
                if (lastResults) {
                    displayResults(lastResults, 'json-output-a', 'structured-output-a');
                }
            } else {
                toggle.classList.remove('active');
                singleResult.style.display = 'grid';
                comparisonResult.style.display = 'none';
            }
        }

        // Display results
        function displayResults(result, jsonOutputId, structuredOutputId) {
            // Display JSON
            document.getElementById(jsonOutputId).textContent = JSON.stringify(result, null, 2);
            
            // Display structured content
            const structuredOutput = document.getElementById(structuredOutputId);
            structuredOutput.innerHTML = generateStructuredHTML(result);
        }

        // Display error
        function displayError(error, jsonOutputId, structuredOutputId) {
            document.getElementById(jsonOutputId).textContent = `Error: ${error}`;
            document.getElementById(structuredOutputId).innerHTML = `
                <div class="error-display">
                    <h5>Processing Error</h5>
                    <p>${error}</p>
                </div>
            `;
        }

        // Generate structured HTML
        function generateStructuredHTML(result) {
            let html = '';
            
            // Confidence score banner
            html += `<div class="confidence-display">Parsing Confidence: ${(result.confidence_score * 100).toFixed(1)}%</div>`;
            
            // CV Header with personal info
            html += '<div class="cv-header">';
            html += `<h2 class="cv-name">${result.full_name || 'Name Not Specified'}</h2>`;
            
            html += '<div class="cv-contact-info">';
            if (result.email) html += `<span class="contact-item">📧 ${result.email}</span>`;
            if (result.phone) html += `<span class="contact-item">📞 ${result.phone}</span>`;
            if (result.location) html += `<span class="contact-item">📍 ${result.location}</span>`;
            html += '</div>';
            
            html += '<div class="cv-links">';
            if (result.linkedin_url) html += `<span class="link-item">🔗 <a href="${result.linkedin_url}" target="_blank">LinkedIn</a></span>`;
            if (result.portfolio_url) html += `<span class="link-item">🌐 <a href="${result.portfolio_url}" target="_blank">Portfolio</a></span>`;
            html += '</div>';
            html += '</div>';
            
            // Professional Summary
            if (result.professional_summary && result.professional_summary.length > 0) {
                html += '<div class="cv-section">';
                html += '<h3 class="section-title">PROFESSIONAL SUMMARY</h3>';
                html += '<div class="section-content">';
                result.professional_summary.forEach(item => {
                    html += `<p class="summary-text">${item}</p>`;
                });
                html += '</div>';
                html += '</div>';
            }
            
            // Key Skills
            if (result.key_skills && result.key_skills.length > 0) {
                html += '<div class="cv-section">';
                html += '<h3 class="section-title">TECHNICAL SKILLS</h3>';
                html += '<div class="section-content">';
                html += '<div class="skills-container">';
                result.key_skills.forEach(skill => {
                    html += `<span class="skill-badge">${skill}</span>`;
                });
                html += '</div>';
                html += '</div>';
                html += '</div>';
            }
            
            // Work Experience
            if (result.work_experience && result.work_experience.length > 0) {
                html += '<div class="cv-section">';
                html += '<h3 class="section-title">PROFESSIONAL EXPERIENCE</h3>';
                html += '<div class="section-content">';
                result.work_experience.forEach(job => {
                    html += '<div class="experience-entry">';
                    html += '<div class="experience-header">';
                    html += `<h4 class="position-title">${job.position || 'Position not specified'}</h4>`;
                    if (job.duration) html += `<span class="duration-badge">${job.duration}</span>`;
                    html += '</div>';
                    if (job.company) html += `<div class="company-name">${job.company}</div>`;
                    if (job.responsibilities && job.responsibilities.length > 0) {
                        html += '<ul class="responsibilities-list">';
                        job.responsibilities.forEach(resp => {
                            html += `<li>${resp}</li>`;
                        });
                        html += '</ul>';
                    }
                    html += '</div>';
                });
                html += '</div>';
                html += '</div>';
            }
            
            // Education
            if (result.education && result.education.length > 0) {
                html += '<div class="cv-section">';
                html += '<h3 class="section-title">EDUCATION</h3>';
                html += '<div class="section-content">';
                result.education.forEach(edu => {
                    html += '<div class="education-entry">';
                    html += '<div class="education-header">';
                    html += `<h4 class="degree-title">${edu.degree || 'Degree not specified'}`;
                    if (edu.field) html += ` in ${edu.field}`;
                    html += '</h4>';
                    if (edu.graduation) html += `<span class="graduation-year">${edu.graduation}</span>`;
                    html += '</div>';
                    if (edu.institution) html += `<div class="institution-name">${edu.institution}`;
                    if (edu.gpa) html += ` | GPA: ${edu.gpa}`;
                    html += '</div>';
                    html += '</div>';
                });
                html += '</div>';
                html += '</div>';
            }
            
            // Certifications
            if (result.certifications && result.certifications.length > 0) {
                html += '<div class="cv-section">';
                html += '<h3 class="section-title">CERTIFICATIONS</h3>';
                html += '<div class="section-content">';
                html += '<ul class="certifications-list">';
                result.certifications.forEach(cert => {
                    html += `<li class="certification-item">🏆 ${cert}</li>`;
                });
                html += '</ul>';
                html += '</div>';
                html += '</div>';
            }
            
            // Projects
            if (result.projects && result.projects.length > 0) {
                html += '<div class="cv-section">';
                html += '<h3 class="section-title">NOTABLE PROJECTS</h3>';
                html += '<div class="section-content">';
                result.projects.forEach(project => {
                    html += '<div class="project-entry">';
                    html += `<h4 class="project-title">${project.name || 'Project name not specified'}</h4>`;
                    if (project.description) html += `<p class="project-description">${project.description}</p>`;
                    if (project.technologies) html += `<div class="project-tech"><strong>Technologies:</strong> ${project.technologies}</div>`;
                    if (project.url) html += `<div class="project-link">🌐 <a href="${project.url}" target="_blank">View Project</a></div>`;
                    html += '</div>';
                });
                html += '</div>';
                html += '</div>';
            }
            
            // Additional sections in a compact grid
            html += '<div class="cv-additional-sections">';
            
            // Languages
            if (result.languages && result.languages.length > 0) {
                html += '<div class="additional-section">';
                html += '<h3 class="section-title">LANGUAGES</h3>';
                html += '<div class="languages-container">';
                result.languages.forEach(lang => {
                    html += `<span class="language-tag">${lang}</span>`;
                });
                html += '</div>';
                html += '</div>';
            }
            
            // Achievements
            if (result.achievements && result.achievements.length > 0) {
                html += '<div class="additional-section">';
                html += '<h3 class="section-title">ACHIEVEMENTS</h3>';
                html += '<ul class="achievements-list">';
                result.achievements.forEach(achievement => {
                    html += `<li class="achievement-item">🏅 ${achievement}</li>`;
                });
                html += '</ul>';
                html += '</div>';
            }
            
            // Volunteer Work
            if (result.volunteer_work && result.volunteer_work.length > 0) {
                html += '<div class="additional-section">';
                html += '<h3 class="section-title">VOLUNTEER EXPERIENCE</h3>';
                html += '<ul class="volunteer-list">';
                result.volunteer_work.forEach(volunteer => {
                    html += `<li class="volunteer-item">🤝 ${volunteer}</li>`;
                });
                html += '</ul>';
                html += '</div>';
            }
            
            html += '</div>'; // End additional sections
            
            // Parsing Notes (if any)
            if (result.parsing_notes && result.parsing_notes.length > 0) {
                html += '<div class="cv-section parsing-notes">';
                html += '<h3 class="section-title">PARSING NOTES</h3>';
                html += '<div class="section-content">';
                result.parsing_notes.forEach(note => {
                    html += `<div class="parsing-note">⚠️ ${note}</div>`;
                });
                html += '</div>';
                html += '</div>';
            }
            
            return html;
        }

        // Update status indicator
        function updateStatus(status, message) {
            const indicator = document.getElementById('statusIndicator');
            const btn = document.getElementById('processBtn');
            
            indicator.className = 'status-indicator';
            btn.disabled = false;
            
            switch(status) {
                case 'success':
                    indicator.classList.add('status-success');
                    break;
                case 'error':
                    indicator.classList.add('status-error');
                    break;
                case 'processing':
                    indicator.classList.add('status-processing');
                    btn.disabled = true;
                    break;
            }
            
            console.log(`Status: ${status} - ${message}`);
        }

        // Placeholder functions for missing features
        function savePrompt() {
            updateStatus('error', 'Save prompt feature not implemented yet');
        }
    </script>
</body>
</html>